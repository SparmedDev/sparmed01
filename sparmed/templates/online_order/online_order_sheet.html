{% extends 'base.html' %}

{% load static from staticfiles %}
{% load bootstrap3 %}
{% load compress %}

{% block pagedescription %}Place an order online easily and safely using SparMED's online order sheet{% endblock %}
{% block title %}Online Order Sheet{% endblock %}

{% block body %}
<ol class="breadcrumb">
  <li><a href="{% url 'distributor-login' %}">Distributor Home Panel</a></li>
  <li class="active">Online Order Sheet</li>
</ol>

<h2 class="text-center">Online Order Sheet</h2>

<hr>

<div class="row">
  <div class="col-sm-5">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4>Company Details</h4>
      </div>
      <div class="panel-body">          
        <p class="text-muted text-small">
          <strong>{{ user.company_name }}</strong><br>
          {{ user.address}}<br>
          {{ user.postal_code }} {{ user.city}}, {{ user.country }}
        </p>
        <p class="text-muted text-small">
          Att: {{ user.contact_person_name }}<br>
          Telephone: {{ user.contact_telephone }}<br>
          Email: {{ user.email }}<br>
        </p>

        {% if cookie_account_change %}
        <div class="alert alert-warning alert-dismissible" role="alert">
          <button id="close-account-change-btn" type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <span class="glyphicon glyphicon-exclamation-sign"></span> If you need to change your company details, click on the account <a class="alert-link" href="{{ user.get_absolute_url }}"><span class="glyphicon glyphicon-wrench"></span></a> button almost in the top-right corner of your screen.
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-sm-7">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4>Products in Cart</h4>
      </div>    

      {% if get_cart and get_cart.count > 0 %}
      <div class="panel-body">  
        <p>Add more products to your cart through the <a href="{% url 'inventory' %}">inventory page</a>, the <a href="{% url 'products' %}">products page</a>, or the search box below.</p>        
      </div>      

      <form method="post" action="{% url 'add-to-cart-search' %}" class="autocomplete-me">
        {% csrf_token %}
        <div class="form-group">
          <input type="text" id="id_q" name="q" class="form-control" placeholder="Start typing an ID to search for products matching that ID" required />
        </div>
        <div class="form-group col-sm-4">
          <input class="btn btn-info" type="submit" value="Add New Product" />
        </div>
      </form>  

      <form role="form" class="form" action="{% url 'set-quantity-cart' %}" method="post">
        {% csrf_token %}
        <table class="table table-bordered table-hover">
          <tr>
            <th>Product (ID-Name)</th>
            <th>Quantity</th>
            <th>Remove?</th>
          </tr>

          {% for item in get_cart %}          
          <tr>
            <td>
              <p class="text-small"><a title="View the product details page" href="{{ item.product.get_absolute_url }}">{{ item.product.product_id }} - {{ item.product.get_name|safe }}</a></p>
            </td>
            <td>
              <div class="form-group">
                <input class="form-control" name="{{ item.object_id }}_quantity-field" id="{{ item.object_id }}_quantity-field" type="number" min=1 value="{{ item.quantity }}" required />
              </div>
            </td>
            <td>
              <a class="btn btn-lg btn-block" href="{% url 'remove-from-cart' item.object_id %}"><span aria-hidden="true">&times;</span><span class="sr-only">Remove</span></a>
            </td>
          </tr>
          {% endfor %}          
        </table>    

        <div style="display: block; margin: 20px; width: 100%;">
          <input class="btn btn-primary" type="submit" value="Update Cart" />
          <a style="margin: 5px 10px;" class="btn btn-warning" href="{% url 'clear-cart' %}">Clear Cart</a>
        </div>              

      </form>

      {% else %}
      <section>  
        <p><span class="minor-skip"></span></p>
        {% if 'error' in order_feedback %}
        <div class="alert alert-danger alert-dismissible" role="alert">
          <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <p><span class="glyphicon glyphicon-exclamation-sign"></span> You must add some products to your cart through the <a class="alert-link" href="{% url 'inventory' %}">inventory page</a>, the <a class="alert-link" href="{% url 'products' %}">products page</a>, or the search box below, before being able to send an order.</p>
        </div>
        {% else %}
        <div class="alert alert-info alert-dismissible" role="alert">
          <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <span class="glyphicon glyphicon-exclamation-sign"></span> Please add some products to your cart through the <a class="alert-link" href="{% url 'inventory' %}">inventory page</a>, the <a class="alert-link" href="{% url 'products' %}">products page</a>, or the search box below.
        </div>         
        {% endif %}   

        <form method="post" action="{% url 'add-to-cart-search' %}" class="autocomplete-me">
          {% csrf_token %}
          <div class="form-group">
            <input type="text" id="id_q" name="q" class="form-control" placeholder="Start typing an ID to search for products matching that ID" required />
          </div>
          <div class="form-group col-sm-4">
            <input class="btn btn-info form-control" type="submit" value="Add New Product" />
          </div>
        </form>    
      </section>
      <div class="clearfix"></div>          
      {% endif %}
    </div>

  </div>

</div>

<hr>

<form class="form form-horizontal" role="form" action="{% url 'order-online' %}" method="post">
  {% csrf_token %}
  <div class="form-group">
    <label class="control-label col-sm-4" for="arranged_freight">Freight arranged by SparMed?</label>  
    <input style="display: inline-block; width: 50px;" type="checkbox" class="form-control col-sm-4" id="arranged_freight" name="arranged_freight" checked 
           onclick="javascript:toggleVisible('arranged_freight_options');" />
  </div>

  <article id="arranged_freight_options">
    {% bootstrap_field form.freight_forwarder %}
    {% bootstrap_field form.account_no %}
  </article>

  <hr>

  <div class="form-group">
    <label class="control-label col-sm-4" for="arranged_packing">Packaging arranged by SparMED?</label>
    <input style="display: inline-block; width: 50px;" type="checkbox" class="form-control col-sm-4" id="arranged_packing" name="arranged_packing" checked 
           onclick="javascript:toggleVisible('arranged_packing_options');" />
    <span class="help-block">Please note if SparMED arranges packaging, we will choose the best and safest way of packing your order.</span>
  </div>

  <article id="arranged_packing_options">
    {% bootstrap_field form.packing_instructions %}
    {% bootstrap_field form.packing_remarks %}

    {% bootstrap_field form.aircleaner_instructions %}
  </article>

  <hr>

  <div class="form-group">
    <label class="control-label col-sm-4" for="shipping_and_invoice_same">Same delivery address?</label>  
    <input style="display: inline-block; width: 50px;" type="checkbox" class="form-control col-sm-4" id="shipping_and_invoice_same" name="shipping_and_invoice_same" checked 
           onclick="javascript:toggleVisible('invoice_options'); " />
  </div>

  <article id="invoice_options">
    {% bootstrap_field form.invoice_company_name %}
    {% bootstrap_field form.invoice_company_address %}
    {% bootstrap_field form.invoice_company_postal_code  %}
    {% bootstrap_field form.invoice_company_country %}            
  </article>  

  <hr>

  <div class="form-group">
    <label class="control-label col-sm-4" for="insurance_desired">Insurance Chosen?</label>  
    <input style="display: inline-block; width: 50px;" type="checkbox" class="form-control col-sm-4" id="insurance_desired" name="insurance_desired"  checked />
  </div>  

  <hr>

  <div class="form-group">
    <label class="control-label" for="documents">Any specific documents along with your shipment?</label>  
    <textarea class="form-control" rows="2" id="documents" name="documents" placeholder="Please write down here if you need any specific documents along with your shipment"></textarea>
  </div>    

  <hr>

  <div class="form-group">
    <label class="control-label" for="other_remarks">Any other remarks or comments regarding this order?</label>  
    <textarea class="form-control" rows="2" id="other_remarks" name="other_remarks" placeholder="Please write down here if you have any other remarks or comments regarding this order"></textarea>
  </div>
  
  <hr>

  {% buttons submit='Send Order' %}{% endbuttons %}
</form>

{% endblock %}

{% block endbody %}

{% compress js inline %}
<script type="text/javascript">
  $(function() {  
    $("#arranged_freight_options").toggle();
    $("#arranged_packing_options").toggle();
    $("#invoice_options").toggle();
  });

  function toggleVisible(divid) {
    $("#" + divid).toggle(500); 
  }
</script>
{% endcompress %}

<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
<link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/smoothness/jquery-ui.min.css" rel="stylesheet">

{% compress js inline %}
<script type="text/javascript">  
  $(function() {   
    var self = $("#id_q");

    $("#id_q").autocomplete({
      delay: 400,
      minLength: 3,
      source: function(request, response) {
        $.ajax({
          url: "{% url 'autocomplete-url' %}", 
          data: {
            'q': self.val(),
          }, 
          success: function(data) {
            response(data.results || []);
          }
        });
      }
    });
  });  
</script>
{% endcompress %}

{% compress js inline %}
<script type="text/javascript">
  $(function() {
    var csrftoken = getCookie('csrftoken');

    $.ajaxSetup({
      beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
          xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
      }
    });      
  });

  $("#close-account-change-btn").click(function(event) {
    $.post("{% url 'remove-account-change-cookie' %}");          
  });
</script>
{% endcompress %}

{% endblock %}