{% extends 'base.html' %}

{% load static from staticfiles %}
{% load bootstrap3 %}
{% load compress %}
{% load base_extras %}
{% load cache %}

{% block pagedescription %}View SparMED inventory - all products and their numbers on stock{% endblock %}
{% block title %}Inventory{% endblock %}

{% block head %}
<!--<script type="text/javascript" charset="utf-8" src="//raw.githubusercontent.com/e-conomic/rest-api-examples/master/RestPOC/Scripts/json2.js"></script>
<script type="text/javascript" charset="utf-8" src="//raw.githubusercontent.com/e-conomic/rest-api-examples/master/RestPOC/Scripts/underscore.min.js"></script>-->
{% endblock %}

{% block body %}

<ol class="breadcrumb">
  <li><a href="{% url 'distributor-login' %}">Distributor Home Panel</a></li>
  <li class="active">Inventory</li>
</ol>

{% cache 6400 sparmed-inventory %}
<article>  
  <h2 class="text-center">Inventory</h2>
  
  <hr>

  {% for category in categories %}
  {% if category.products.all|length %}
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3>{{ category.name|safe }}</h3>
    </div>

    {% for subcategory in category.subcategories.all %}
    {% if subcategory.products.all|length %}
    <div class="panel-body">
      <h4>{{ subcategory.name|safe }}</h4>
    </div>

    <table class="table table-hover table-bordered table-condensed">
      <tr>
        <th class="td-max-col-width"><p class="text-center">Add to Cart</p></th>
        <th class="td-max-col-width"><p class="text-center">Quantity</p></th>
        <th class="td-max-150-col-width">Product ID</th>
        <th>Product Name</th>
        <!--<th><p class="text-center">On Stock</p></th>
        <th><p class="text-center">Available</p></th>-->
      </tr>

      {% for product in subcategory.products.all %}
      <form role="form" class="form">
        {#% csrf_token %#}   
      <tr>
        <td class="td-max-col-width">
          <script type="text/javascript">
            //$(function(){
                $("#{{ product.id }}_add_to_cart").on("click", function(event) {
                    console.log("add to cart");
                    var quantity = $("#{{ product.id }}_quantity_field").val(); 
                    var post_url = "{% url 'add-to-cart-inventory' product.category.slug product.id %}";

                    var post = post_url + "/" + quantity;
                    //window.location.href = post;
                    $.post(post, function(data){ 
                      console.log("posted to: " + post);
                    });
                    return false;
                });
            //});
          </script>          
          
          <p class="text-center" style="cursor:pointer; color:red; padding: 5px;" id="{{ product.id }}_add_to_cart"><span class="glyphicon glyphicon-shopping-cart"></span></p>        

        </td>
        <td>           
          <div class="form-group">
            <input class="form-control" name="field" id="{{ product.id }}_quantity_field" type="number" value="1" min="1" required />
          </div>
        </td>
        <td>
          <a title="View the product details page" href="{{ product.get_absolute_url }}">{{ product.product_id }}</a>
        </td>
        <td><p>{{ product.name }}</p></td>
        <!--<td><p class="text-center">{{ product.in_stock }}</p></td>
        <td><p class="text-center">(available)</p></td>-->
      </tr>          
      </form>
      {% endfor %}
    </table>
    {% endif %}
    {% endfor %}

  </div> 
  {% endif %}
  {% endfor %}
  
  <p class="text-center">
      Can't find the product you're looking for? <a href="{% url 'contact' %}">Contact us</a> for information on unlisted products.
  </p>
</article>
{% endcache %}

{% endblock %}

{% block endbody %}
{% endblock %}