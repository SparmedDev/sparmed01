{% extends 'base.html' %}

{% load static from staticfiles %}
{% load bootstrap3 %}

{% block pagedescription %}Distributors in the GOosafe SparMed family{% endblock %}
{% block title %}Distributors{% endblock %}

{% block outerbody %}

<h2 class="text-center">Distributors</h2>
<p><br></p>
<hr>

<section>
  <p class="text-center text-dark-blue">
    <strong>      
    SparMED has a premium distributor network spread all over the globe. <br>
    Are you looking for a distributor in your area? Please <a href="{% url 'contact' %}">contact us</a>.
    </strong>
  </p>

  <hr>

  <section class="hidden-xs">
      <article id="distributors-map">
        <img id="distributors-map-image" src="{% static 'img/distributors/world_map_full_robproj_2.jpg' %}" alt="SparMED Global Distributor Network">   
      </article>   
    
      <hr>
  </section>  

  <p class="text-center text-dark-blue extra-margin-bot">
    <strong>
    Would you like to become one of our distributors and join our world-wide distributor network? <br> <a href="{% url 'contact' %}">CONTACT US</a>
    </strong>
  </p>
</section>

{% endblock %}

{% block endbody %}

{% compress js inline %}
<script type="text/javascript" src="{% static 'js/robinson.js' %}" charset="utf-8"></script>
{% endcompress %}

<script type="text/javascript" charset="utf-8">
  var distributors = [
    {% for distributor in distributors %}
    {
      country: "{{ distributor.country }}",
      latitude: {{ distributor.latitude }},
      longitude: {{ distributor.longitude }},
    },
    {% endfor %}
  ];

  function setupDots() {   
    $(".map-dot").remove();

    var map = $("#distributors-map-image");
    var mapWidth = map.width();
    var mapHeight = map.outerHeight(true); /* get map height including padding & margin */
    var robinson = new Robinson(mapWidth, mapHeight, mapWidth < 1100 ? -27 : -33, mapWidth < 1100 ? -17 : -19);

    distributors.forEach(function(value, index, ar) {          
      var country = value.country;
      var id = country.replace(/\s/g, "").toLowerCase() + "-dot";
      var newDiv = "<div id='" + id + "' class='map-dot'><p>" + country + "</p></div>";
      $("#distributors-map").append(newDiv);

      var p = robinson.projectToCSS(value.latitude, value.longitude);
      $("#" + id).css({
        "left": Math.round(p.x) + 'px',
        "top": Math.round(p.y) + 'px',
      });      
    });
    
  };

  $(window).load(function() {
    setupDots();
    $(window).resize(setupDots);
  });

</script>

{% endblock %}