{% extends 'base.html' %}

{% load static from staticfiles %}
{% load bootstrap3 %}
{% load compress %}
{% load base_extras %}
{% load cache %}

{% block pagedescription %}Browse the finest quality IVF Laboratory equipment{% endblock %}
{% block title %}Products{% endblock %}


{% block body %}

<style>
  
.category-article > h1 {
    border-top: 3px solid #008393;
    border-bottom: 3px solid #008393;
  
    padding: 20px;
}  
  
.category-article > p {
    display: block;
    font-weight: bold;
    margin-top: 30px;
    margin-bottom: 50px;
    margin-left: auto;
    margin-right: auto;
    width: 70%;
}
  
</style>

{% cache 3600 products-categories-nav-bar category.slug %}
{% if categories %}
<nav id="products-nav" role="navigation">
  <ul class="nav nav-tabs" role="tablist">
    {% for cat in categories reversed %}
    <li class="{% productnavactive request cat.slug %}"><a href="{{ cat.get_absolute_url }}">{{ cat.short_name }}</a></li>
    {% endfor %}
  </ul>
</nav>
{% endif %}
{% endcache %}

<article class="category-article">
  {% cache 3600 products-category-article-top category.slug %}
  <h1 class="text-center">{{ category.name }}</h1>
  {% if category.description %}<p class="text-center"><em>{{ category.description }}</em></p>{% endif %}
  <section>
    <h4 class="text-center"><a href="{{ category.document.url }}">PDF File <span class="glyphicon glyphicon-file"></span></a></h4>
  </section>  
  {% if category.long_text %}
  <section class="two-column">
      {{ category.long_text|safe }}
  </section>
  {% endif %}
  {% endcache %}
  <hr>

  {% with subcats=category.subcategories.all %}
  {% for subcat in subcats %}
  <h2 class="text-center">{{ subcat.name }}</h2>
  {% if subcat.description %}<p class="text-center"><em>{{ subcat.description }}</em></p>{% endif %}
  
  {% with productscount=subcat.products.all|length %}
  {% compress js inline %}
  <script type="text/javascript">
      $(document).ready(function() {
          {% if productscount > 3 %}
          $("#{{ subcat.slug }}-list").css("width", "100%");
          {% else %}
          $("#{{ subcat.slug }}-list").css("width", "{% widthratio productscount 1 250 %}px");
          {% endif %}
      });    
  </script>  
  {% endcompress %}
  {% endwith %}
    
  {% for product in subcat.products.all reversed %}
  {% if forloop.first %}<ul id="{{ subcat.slug }}-list" class="products-list">{% endif %}
  <li class="product-item">
    <h4 class="text-center"><a title="{{ product.name }}" href="{{ product.get_absolute_url }}">{{ product.name }}</a></h4>
    <p class="text-center"><strong>Product ID: {{ product.product_id }}</strong></p>

    {% for image in product.images.all reversed %}
    {% if forloop.first %}
      {% if image %}
      <p><img class="img-responsive img-rounded product-image" alt="{{ image.image_title }}" src="{{ image.get_absolute_url }}"></p>
      {% endif %}
    {% endif %}
    {% endfor %}
    
    {% if user.is_anonymous %}
    <p class="text-muted text-center">Add to Cart <span class="glyphicon glyphicon-shopping-cart"></span><br>(Login required)</p>
    {% else %}
    <p class="text-center"><a href="{% url 'add-to-cart' category.slug product.id %}">Add to Cart <span class="glyphicon glyphicon-shopping-cart"></span></a></p>
    {% endif %}
  </li>
  {% if forloop.last %}</ul>{% endif %}
  {% endfor %}

  {% if not forloop.last %}<hr>{% endif %}

  {% endfor %}
  {% endwith %}
  
</article>
{% endblock %}